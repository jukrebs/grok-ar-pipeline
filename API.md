# Grok 3D Pipeline API

## Base URL

```
http://your-server:8000
```

## Endpoints

### 1. Generate 3D Model

Start a new generation job from a text prompt.

**Endpoint:** `POST /api/generate`

**Request Body:**
```json
{
  "prompt": "A futuristic robot cat with glowing blue eyes"
}
```

**Response:**
```json
{
  "job_id": "6cb6d335",
  "status": "queued"
}
```

**Status Codes:**
- `200` - Job created successfully
- `400` - Invalid request body
- `500` - Server error

---

### 2. Get Job Status

Check the status and progress of a generation job.

**Endpoint:** `GET /api/status/{job_id}`

**URL Parameters:**
- `job_id` - The job ID returned from the generate endpoint

**Response (Processing):**
```json
{
  "job_id": "6cb6d335",
  "status": "processing",
  "stage": "generating_3d",
  "progress": 50,
  "created_at": "2026-01-17T14:54:00.000000",
  "prompt": "A futuristic robot cat with glowing blue eyes",
  "error": null
}
```

**Response (Complete):**
```json
{
  "job_id": "6cb6d335",
  "status": "complete",
  "stage": "complete",
  "progress": 100,
  "created_at": "2026-01-17T14:54:00.000000",
  "prompt": "A futuristic robot cat with glowing blue eyes",
  "error": null
}
```

**Response (Error):**
```json
{
  "job_id": "6cb6d335",
  "status": "error",
  "stage": "error",
  "progress": 0,
  "created_at": "2026-01-17T14:54:00.000000",
  "prompt": "A futuristic robot cat with glowing blue eyes",
  "error": "Error message here"
}
```

**Status Values:**
- `queued` - Job is in queue, waiting to start
- `processing` - Job is currently processing
- `complete` - Job finished successfully
- `error` - Job failed

**Stage Values:**
- `initializing` - Setting up the job
- `generating_image` - Creating image from prompt (xAI Grok)
- `generating_3d` - Creating 3D model from image (TripoSR)
- `converting_usdz` - Converting GLB to USDZ format (Blender)
- `complete` - All steps finished
- `error` - Job failed

**Status Codes:**
- `200` - Status retrieved successfully
- `404` - Job not found
- `500` - Server error

---

### 3. Download Generated Asset

Download a generated asset (image, GLB, or USDZ).

**Endpoint:** `GET /api/asset/{job_id}?asset_type={asset_type}`

**URL Parameters:**
- `job_id` - The job ID
- `asset_type` - Type of asset to download: `image`, `glb`, or `usdz`

**Example Requests:**
```
GET /api/asset/6cb6d335?asset_type=usdz
GET /api/asset/6cb6d335?asset_type=glb
GET /api/asset/6cb6d335?asset_type=image
```

**Response:**
- Binary file download (application/octet-stream)

**Status Codes:**
- `200` - Asset retrieved successfully
- `404` - Job or asset not found
- `400` - Invalid asset type
- `500` - Server error

**Asset Types:**
- `image` - JPG image generated by xAI Grok
- `glb` - 3D model in GLB format (binary glTF)
- `usdz` - 3D model in USDZ format (Apple AR format)

---

### 4. Get Examples

Get a list of pre-rendered example models that can be displayed instantly without waiting for generation.

**Endpoint:** `GET /api/examples`

**Response:**
```json
{
  "examples": [
    {
      "job_id": "ex_elon-figurine",
      "name": "Elon Figurine",
      "description": "Collectible Elon Musk figurine with premium quality design",
      "image_url": "/api/asset/ex_elon-figurine?asset_type=image"
    },
    {
      "job_id": "ex_mars-habitat",
      "name": "Mars Habitat",
      "description": "Futuristic Mars habitat dome with sci-fi architecture",
      "image_url": "/api/asset/ex_mars-habitat?asset_type=image"
    },
    {
      "job_id": "ex_xai-robot",
      "name": "xAI Robot",
      "description": "Friendly xAI robot mascot with sleek modern design",
      "image_url": "/api/asset/ex_xai-robot?asset_type=image"
    }
  ]
}
```

**Status Codes:**
- `200` - Examples retrieved successfully
- `500` - Server error

**Usage:**
Examples can be used to:
1. Display clickable cards on the frontend for instant demo
2. Allow users to explore pre-generated 3D models without waiting
3. Serve as templates for generating similar models

After selecting an example, you can immediately fetch its assets:
- `GET /api/asset/{example_job_id}?asset_type=usdz` - Download USDZ for AR
- `GET /api/asset/{example_job_id}?asset_type=glb` - Download GLB for 3D viewers
- `GET /api/asset/{example_job_id}?asset_type=image` - Download preview image

**Note:** Example jobs have `status: "complete"` and `progress: 100` when queried via `/api/status/{example_id}`.

---

## Pipeline Flow

### Option A: Generate New Model

1. **Generate Request** → POST `/api/generate` with prompt
2. **Get Job ID** → Use returned `job_id` to track progress
3. **Poll Status** → GET `/api/status/{job_id}` every 2-3 seconds
4. **Check Completion** → When `status === "complete"`, assets are ready
5. **Download Assets** → GET `/api/asset/{job_id}?asset_type={type}`

### Option B: Use Pre-rendered Example

1. **Get Examples** → GET `/api/examples` to see available examples
2. **Select Example** → User clicks on an example card
3. **Download Asset** → GET `/api/asset/{example_job_id}?asset_type=usdz` (instant, no waiting)

Examples are useful for:
- Quick demos without API calls
- Showcasing capabilities with high-quality results
- Letting users explore before generating their own

## Usage Examples

### Generate New Model (With Polling)

```javascript
async function generateAndDownload(prompt) {
  // Start generation
  const response = await fetch('http://your-server:8000/api/generate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt })
  });
  const { job_id } = await response.json();

  // Poll status until complete
  const poll = setInterval(async () => {
    const statusResponse = await fetch(`http://your-server:8000/api/status/${job_id}`);
    const status = await statusResponse.json();

    console.log(`Progress: ${status.progress}% - Stage: ${status.stage}`);

    if (status.status === 'complete') {
      clearInterval(poll);

      // Download USDZ (iPhone AR)
      window.location.href = `http://your-server:8000/api/asset/${job_id}?asset_type=usdz`;
    } else if (status.status === 'error') {
      clearInterval(poll);
      console.error('Generation failed:', status.error);
    }
  }, 2000);
}
```

### Display Pre-rendered Examples

```javascript
async function loadExamples() {
  const response = await fetch('http://your-server:8000/api/examples');
  const { examples } = await response.json();

  examples.forEach(example => {
    // Create clickable card for each example
    const card = document.createElement('div');
    card.className = 'example-card';
    card.innerHTML = `
      <img src="${example.image_url}" alt="${example.name}">
      <h3>${example.name}</h3>
      <p>${example.description}</p>
    `;

    // On click, download USDZ instantly (no waiting)
    card.onclick = () => {
      window.location.href = `http://your-server:8000/api/asset/${example.job_id}?asset_type=usdz`;
    };

    document.getElementById('examples-container').appendChild(card);
  });
}
```

## Error Handling

All error responses include an `error` field with details:

```json
{
  "error": "Error message describing what went wrong"
}
```

Common errors:
- `No prompt provided` - Missing or empty prompt in generate request
- `Job not found` - Invalid job_id in status/asset requests
- `Invalid asset type` - asset_type must be one of: image, glb, usdz
- `Asset not found` - Asset hasn't been generated yet or job failed

## CORS

The API supports CORS for cross-origin requests. Configure allowed origins in the FastAPI app if deploying to a different domain.

## Rate Limiting

No rate limiting is currently implemented. Consider adding for production use.

## Data Retention

Generated job data is stored in `/data/jobs/{job_id}/` and persisted until manually deleted. Implement a cleanup job if needed for production.
